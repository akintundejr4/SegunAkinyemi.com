{% if site.footer_scripts %}
{% for script in site.footer_scripts %}
<script src="{{ script | relative_url }}"></script>
{% endfor %}
{% else %}
<script src="{{ '/assets/js/main.min.js' | relative_url }}"></script>
{% endif %}

{% if site.search == true or page.layout == "search" %}
{%- assign search_provider = site.search_provider | default: "lunr" -%}
{%- case search_provider -%}
{%- when "lunr" -%}
{% include_cached search/lunr-search-scripts.html %}
{%- when "google" -%}
{% include_cached search/google-search-scripts.html %}
{%- when "algolia" -%}
{% include_cached search/algolia-search-scripts.html %}
{%- endcase -%}
{% endif %}

{% include analytics.html %}
{% include /comments-providers/scripts.html %}

{% if site.after_footer_scripts %}
{% for script in site.after_footer_scripts %}
<script src="{{ script | relative_url }}"></script>
{% endfor %}
{% endif %}

<script>
  function setDesiredTheme(desiredTheme) {
    var lightTheme = document.getElementById('theme_source');  // Reference to the main theme stylesheet. Light mode.
    var darkTheme = document.getElementById('theme_source_2'); // Reference to an alternate theme stylesheet. Dark mode.

    var currentTheme = lightTheme.getAttribute('rel') === 'stylesheet' ? 'light' : 'dark';

    if (currentTheme === desiredTheme) {
      return;
    }

    if (desiredTheme === "light") {
      // Change the 'rel' attribute of the light theme stylesheet to 'stylesheet'.
      lightTheme.setAttribute('rel', 'stylesheet');
      // Schedule the following code to run after a 10ms delay.
      setTimeout(function () {
        // After the delay, change the 'rel' attribute of the dark theme stylesheet to 'stylesheet alternate'.
        darkTheme.setAttribute('rel', 'stylesheet alternate');
      }, 10);
      // Store the theme state ('light') in the session storage to remember it.
      sessionStorage.setItem('theme', 'light');
    }
    else if (desiredTheme === "dark") {
      // Change the 'rel' attribute of the dark theme stylesheet to 'stylesheet'.
      darkTheme.setAttribute('rel', 'stylesheet');
      // Schedule the following code to run after a 10ms delay.
      setTimeout(function () {
        // After the delay, change the 'rel' attribute of the light theme stylesheet to 'stylesheet alternate'.
        lightTheme.setAttribute('rel', 'stylesheet alternate');
      }, 10);
      // Store the theme state ('dark') in the session storage to remember it.
      sessionStorage.setItem('theme', 'dark');
    }
  }

  function themeSwitch() {
    var lightTheme = document.getElementById('theme_source');  // Reference to the main theme stylesheet. Light mode.
    var darkTheme = document.getElementById('theme_source_2'); // Reference to an alternate theme stylesheet. Dark mode.
    sessionStorage.setItem('hasUserClickedThemeButton', 'true');

    // Check the current state of the main theme stylesheet.
    if (lightTheme.getAttribute('rel') == 'stylesheet') {
      // If the light theme is currently active (linked as a stylesheet), do the following:
      setDesiredTheme("dark");
    } else {
      // Else If the dark theme is active, do the following:
      setDesiredTheme("light");
    }

    // Return false to prevent the default behavior of the button (e.g., submitting a form or navigating to a new page).
    return false;
  }

  function setThemeBasedOnTime() {
    const currentTime = new Date();
    const currentUTCHours = currentTime.getUTCHours();
    var hasUserClickedThemeButton = sessionStorage.getItem('hasUserClickedThemeButton');

    if (hasUserClickedThemeButton === "true") {
      // Respect a user who has chosen a theme by clicking the button. If so, do nothing, leave it as they requested.
      return;
    }

    // Check if the current time is between 5 PM (17:00) and 11 AM (11:00) UTC.
    if (currentUTCHours >= 17 || currentUTCHours < 11) {
      setDesiredTheme("dark");
    }
    else {
      setDesiredTheme("light");
    }
  }

  window.addEventListener('load', setThemeBasedOnTime);
</script>